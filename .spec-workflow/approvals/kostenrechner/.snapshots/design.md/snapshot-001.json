{
  "id": "snapshot_1763641697681_iy0ql1pp5",
  "approvalId": "approval_1763641697677_pg5yjp7in",
  "approvalTitle": "Design Document - Kostenrechner",
  "version": 1,
  "timestamp": "2025-11-20T12:28:17.681Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document: Kostenrechner\n\n## Overview\n\nDer **Kostenrechner** ist ein interaktiver, 6-stufiger Wizard, der potentiellen Kunden eine transparente Kostensch√§tzung f√ºr Website-, App- und E-Commerce-Projekte bietet. Das Feature kombiniert eine intuitive Multi-Step-Form mit einer intelligenten Berechnungs-Engine und einem **3-Wege-Preisvergleich** (Freelancer vs. Agentur vs. HEADON).\n\n**System-Integration:**\n- **Route**: `/kostenrechner` (neue Next.js App Router Page)\n- **Components**: 20+ neue Components in `components/calculator/`\n- **Backend**: Neue API Route `/api/calculator` + Supabase Integration\n- **Analytics**: Umami Event-Tracking f√ºr Conversion-Funnel\n\n**Tech Stack:**\n- Next.js 15 (App Router) mit React 19\n- TypeScript (Strict Mode)\n- Tailwind CSS v4 + shadcn/ui\n- Framer Motion f√ºr Animationen\n- Zod f√ºr Validation\n- Supabase f√ºr Lead-Storage\n- Resend API f√ºr Email-Notifications\n\n**Key Design Principles:**\n1. **Performance-First**: SSG f√ºr Entry Page, Client-Only f√ºr Calculator State\n2. **Mobile-Optimized**: Touch-friendly, responsive Layouts\n3. **Accessibility**: WCAG AA konform (Keyboard Navigation, Screen Reader)\n4. **Modular Architecture**: Separierte Step Components, wiederverwendbare Utilities\n\n---\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n#### Framework Alignment\n- **Next.js 15 App Router**: Folgt Projekt-Standard f√ºr alle neuen Features\n- **React Server Components**: Entry Page als Server Component, Calculator als Client Component\n- **TypeScript Strict Mode**: Alle Components mit expliziten Types\n- **pnpm**: Package Manager wie projekt√ºbergreifend definiert\n\n#### Component Architecture\n- **shadcn/ui Components**: Bestehende UI-Primitives werden wiederverwendet (Button, Input, Label, Select, Accordion, Dialog, Tabs)\n- **Neue Components hinzuf√ºgen**: `checkbox`, `radio-group`, `slider`, `progress`, `switch`, `tooltip`\n- **Framer Motion**: Animation-Bibliothek bereits im Projekt (wie MultiStepForm)\n- **Class Variance Authority**: F√ºr Comp Variants wie im Projekt etabliert\n\n#### Backend Integration\n- **Supabase PostgreSQL**: Nutzt bestehende Supabase-Infrastruktur (siehe `lib/supabase.ts`)\n- **Resend API**: Nutzt bestehende Email-Integration (Pattern aus `/api/contact`)\n- **API Route Pattern**: Folgt Next.js API Route Conventions mit Zod Validation\n\n#### Validation & Type Safety\n- **Zod Schemas**: Wie in `lib/validations.ts` und `lib/content/frontmatter.ts`\n- **Runtime Validation**: Client + Server-Side Validation\n- **Type Inference**: TypeScript Types aus Zod Schemas ableiten\n\n#### Performance Standards\n- **LCP < 1.5s**: Erf√ºllt Core Web Vitals Requirements\n- **Code Splitting**: React.lazy f√ºr Step Components\n- **Debounced Updates**: Live Preview mit 300ms Debounce\n- **Static Generation**: Entry Page pre-rendered\n\n### Project Structure (structure.md)\n\n#### File Organization\n\n```\napp/kostenrechner/\n‚îú‚îÄ‚îÄ page.tsx                    # Server Component (SEO + Entry)\n‚îú‚îÄ‚îÄ metadata.ts                 # SEO Metadata\n‚îî‚îÄ‚îÄ layout.tsx                  # Optional: Calculator-specific Layout\n\ncomponents/calculator/\n‚îú‚îÄ‚îÄ CostCalculator.tsx          # Main Client Component (State Container)\n‚îú‚îÄ‚îÄ CalculatorProgress.tsx      # Progress Bar (1/6, 2/6, ...)\n‚îú‚îÄ‚îÄ PricePreview.tsx            # Sticky Sidebar (Live Preview)\n‚îÇ\n‚îú‚îÄ‚îÄ steps/\n‚îÇ   ‚îú‚îÄ‚îÄ StepProjectType.tsx     # Step 1\n‚îÇ   ‚îú‚îÄ‚îÄ StepDesignScope.tsx     # Step 2\n‚îÇ   ‚îú‚îÄ‚îÄ StepFeatures.tsx        # Step 3\n‚îÇ   ‚îú‚îÄ‚îÄ StepQuality.tsx         # Step 4\n‚îÇ   ‚îú‚îÄ‚îÄ StepTimeline.tsx        # Step 5\n‚îÇ   ‚îî‚îÄ‚îÄ index.ts                # Barrel export\n‚îÇ\n‚îú‚îÄ‚îÄ results/\n‚îÇ   ‚îú‚îÄ‚îÄ ComparisonGrid.tsx      # 3-Column Layout\n‚îÇ   ‚îú‚îÄ‚îÄ ComparisonCard.tsx      # Single Provider Card\n‚îÇ   ‚îú‚îÄ‚îÄ SavingsHighlight.tsx    # Savings Badge\n‚îÇ   ‚îú‚îÄ‚îÄ PriceBreakdown.tsx      # Detailed Breakdown\n‚îÇ   ‚îú‚îÄ‚îÄ LeadCaptureDialog.tsx   # Lead Form\n‚îÇ   ‚îî‚îÄ‚îÄ index.ts                # Barrel export\n‚îÇ\n‚îî‚îÄ‚îÄ shared/\n    ‚îú‚îÄ‚îÄ ProjectTypeCard.tsx     # Icon Card Component\n    ‚îú‚îÄ‚îÄ FeatureCheckbox.tsx     # Checkbox with Price Badge\n    ‚îú‚îÄ‚îÄ RangeSlider.tsx         # Custom Range Input\n    ‚îú‚îÄ‚îÄ PriceCounter.tsx        # Animated Number Counter\n    ‚îî‚îÄ‚îÄ index.ts                # Barrel export\n\nlib/calculator/\n‚îú‚îÄ‚îÄ types.ts                    # TypeScript Interfaces\n‚îú‚îÄ‚îÄ pricing-config.ts           # Pricing Definitions & Factors\n‚îú‚îÄ‚îÄ calculator-engine.ts        # Calculation Logic (3 Providers)\n‚îú‚îÄ‚îÄ validation-schemas.ts       # Zod Schemas\n‚îî‚îÄ‚îÄ utils.ts                    # Helper Functions\n\napp/api/calculator/\n‚îî‚îÄ‚îÄ route.ts                    # POST: Lead speichern + Email\n\nlib/\n‚îî‚îÄ‚îÄ email-templates.ts          # + createCalculatorResultEmail()\n```\n\n#### Naming Conventions\n- **Components**: PascalCase (`CostCalculator.tsx`, `StepProjectType.tsx`)\n- **Utilities**: camelCase (`pricing-config.ts`, `calculator-engine.ts`)\n- **Types**: PascalCase Interfaces (`CalculatorState`, `ComparisonResult`)\n- **Constants**: SCREAMING_SNAKE_CASE f√ºr exports (`BASE_PRICES`, `DESIGN_MULTIPLIERS`)\n\n#### Import Patterns\n- **Absolute Imports**: `@/components/calculator/*`, `@/lib/calculator/*`\n- **No Relative Paths**: Au√üer co-located files (z.B. `./metadata.ts`)\n- **Barrel Exports**: `steps/index.ts`, `results/index.ts` f√ºr cleane Imports\n\n---\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n#### UI Primitives (shadcn/ui)\n- **Button** (`@/components/ui/button`): Navigation Buttons (Weiter/Zur√ºck), CTAs\n- **Input** (`@/components/ui/input`): Lead Capture Form (Name, Email, Phone)\n- **Textarea** (`@/components/ui/textarea`): Lead Capture Message Field\n- **Label** (`@/components/ui/label`): Form Labels\n- **Select** (`@/components/ui/select`): Dropdowns (Responsiveness, Support-Paket)\n- **Accordion** (`@/components/ui/accordion`): Step 4 Qualit√§ts-Kategorien, Breakdown\n- **Dialog** (`@/components/ui/dialog`): LeadCaptureDialog\n- **Tabs** (`@/components/ui/tabs`): Mobile Comparison View\n- **Badge** (`@/components/ui/badge`): Preis-Badges, Priority-Levels\n- **Card** (`@/components/ui/card`): Comparison Cards\n\n#### New shadcn/ui Components to Add\n```bash\npnpm dlx shadcn@latest add checkbox      # Feature Selection\npnpm dlx shadcn@latest add radio-group   # Design Level, Timeline\npnpm dlx shadcn@latest add slider        # Range Slider (Seiten-Anzahl)\npnpm dlx shadcn@latest add progress      # Progress Bar\npnpm dlx shadcn@latest add switch        # Toggle (Hosting)\npnpm dlx shadcn@latest add tooltip       # Help Text\n```\n\n#### Animation Utilities\n- **Framer Motion** (`framer-motion`): Bereits installiert\n  - **Pattern aus MultiStepForm**: `AnimatePresence`, `motion.div` f√ºr Step Transitions\n  - **Stagger Animations**: Liste von Features/Options animieren\n  - **Counter Animation**: F√ºr PriceCounter Component\n\n#### Utility Functions\n- **cn()** (`@/lib/utils`): Tailwind Class Merging\n- **formatCurrency()**: Neu zu erstellen, Pattern: `12500.00 ‚Üí \"12.500‚Ç¨\"`\n- **formatDuration()**: Neu zu erstellen, Pattern: `6 ‚Üí \"6-8 Wochen\"`\n\n### Integration Points\n\n#### Existing API Pattern (`app/api/contact/route.ts`)\n**Wiederverwendbar:**\n- Supabase Client Setup mit Service Role Key\n- Request Validation mit Zod\n- Error Handling Pattern (Try-Catch, Structured Errors)\n- Email Sending mit Resend API\n- Lead-Score Berechnung\n\n**Anpassungen f√ºr Calculator:**\n- Neue Tabelle `calculator_leads` statt `leads`\n- Erweiterte Lead-Daten (calculator_data, comparison_result)\n- Neue Email-Template Function `createCalculatorResultEmail()`\n\n#### Email Template Pattern (`lib/email-templates.ts`)\n**Wiederverwendbar:**\n- HTML-Email Structure mit Inline CSS\n- Responsive Grid Layout (`info-grid`)\n- Priority-Level Badges (üî• HIGH, ‚ö° MEDIUM, üìù STANDARD)\n- Color-Coded Priority Classes\n\n**Anpassungen f√ºr Calculator:**\n- Neue Sections: 3-Way Comparison Table, Savings Highlight\n- Calculator-Data Display: Selected Features, Quality Level\n- CTA: \"üìÖ Termin buchen\" (Calendly-Link)\n\n#### MultiStepForm Pattern (`app/contact/MultiStepForm.tsx`)\n**Wiederverwendbar:**\n- State Management mit `useState` f√ºr Form Data\n- Step Navigation (handleNext/handlePrev)\n- Progress Bar mit Visual Feedback\n- Step Validation (`isStepValid()`)\n- AnimatePresence f√ºr Step Transitions\n- Responsive Design (Mobile-First)\n\n**Anpassungen f√ºr Calculator:**\n- 6 Steps statt 4\n- Komplexere State (nested objects f√ºr features, quality)\n- Live Preview Sidebar (zus√§tzlich zum Form)\n- URL State Persistence (Query Params)\n\n#### Validation Pattern (`lib/validations.ts`)\n**Wiederverwendbar:**\n- Zod Schema Structure\n- German Error Messages\n- Optional Fields mit `.optional()`\n- Custom Validation mit `.refine()`\n\n**Neue Schemas f√ºr Calculator:**\n- `calculatorStateSchema`: Gesamter Calculator State\n- `leadCaptureSchema`: Lead Form (√§hnlich `contactFormSchema`)\n- `comparisonResultSchema`: Berechnungs-Output\n\n#### Supabase Integration (`lib/supabase.ts`)\n**Wiederverwendbar:**\n- Client-Side Supabase Client f√ºr anonyme Sessions (optional)\n- Server-Side Client mit Service Role Key (API Route)\n- Type Safety mit Database Types (`types/supabase.ts`)\n\n**Neue Tabellen:**\n- `calculator_leads`: Lead-Daten mit Calculator-Results\n- `calculator_sessions`: Optionales anonymes Tracking\n\n---\n\n## Architecture\n\n### System Architecture\n\n```mermaid\ngraph TD\n    subgraph \"Client Layer\"\n        A[Page: /kostenrechner] --> B[CostCalculator]\n        B --> C[Step Components]\n        B --> D[PricePreview]\n        C --> E[Step 1-5]\n        E --> F[Shared Components]\n    end\n\n    subgraph \"Calculation Layer\"\n        G[Calculator Engine] --> H[Pricing Config]\n        G --> I[Utils]\n    end\n\n    subgraph \"Server Layer\"\n        J[API Route: /api/calculator] --> K[Validation]\n        K --> L[Supabase Client]\n        K --> M[Email Service]\n        L --> N[(calculator_leads)]\n        M --> O[Resend API]\n    end\n\n    B --> G\n    E --> G\n    F --> G\n    D --> G\n    B --> J\n\n    style A fill:#e1f5e1\n    style B fill:#fff4e6\n    style G fill:#e3f2fd\n    style J fill:#fce4ec\n    style N fill:#f3e5f5\n```\n\n### Data Flow Architecture\n\n```mermaid\nsequenceDiagram\n    participant U as User\n    participant P as Page\n    participant C as CostCalculator\n    participant E as Calculator Engine\n    participant A as API Route\n    participant S as Supabase\n    participant R as Resend\n\n    U->>P: Navigate to /kostenrechner\n    P->>C: Render Client Component\n    C->>U: Display Step 1\n\n    loop Steps 1-5\n        U->>C: Select Options\n        C->>E: Calculate Price\n        E->>C: Return Estimates\n        C->>U: Update Live Preview\n    end\n\n    C->>U: Display Step 6 (Results)\n    U->>C: Submit Lead Form\n    C->>A: POST /api/calculator\n    A->>S: Save Lead + Comparison\n    S->>A: Confirm Save\n    A->>R: Send Emails (User + Team)\n    R->>A: Confirm Sent\n    A->>C: Return Success\n    C->>U: Show Success Message\n```\n\n### Component Hierarchy\n\n```mermaid\ngraph TD\n    A[page.tsx - Server Component] --> B[CostCalculator.tsx - Client]\n\n    B --> C[CalculatorProgress]\n    B --> D[Current Step Component]\n    B --> E[PricePreview - Sticky]\n\n    D --> D1[StepProjectType]\n    D --> D2[StepDesignScope]\n    D --> D3[StepFeatures]\n    D --> D4[StepQuality]\n    D --> D5[StepTimeline]\n    D --> D6[Results]\n\n    D1 --> S1[ProjectTypeCard]\n    D2 --> S2[RangeSlider]\n    D3 --> S3[FeatureCheckbox]\n    D4 --> S4[Accordion - ui]\n    D5 --> S5[RadioGroup - ui]\n\n    D6 --> R1[ComparisonGrid]\n    R1 --> R2[ComparisonCard x3]\n    D6 --> R3[SavingsHighlight]\n    D6 --> R4[PriceBreakdown]\n    D6 --> R5[LeadCaptureDialog]\n\n    E --> E1[PriceCounter]\n    E --> E2[Timeline Badge]\n    E --> E3[Breakdown List]\n\n    style A fill:#e1f5e1\n    style B fill:#fff4e6\n    style D fill:#e3f2fd\n    style D6 fill:#fce4ec\n```\n\n### Modular Design Principles\n\n#### Single File Responsibility\n- **Step Components**: Jeder Step = Eine Datei mit eigener Verantwortung\n- **Calculator Engine**: Reine Berechnungs-Logik ohne UI\n- **Pricing Config**: Statische Preis-Definitionen getrennt von Logic\n- **Shared Components**: Wiederverwendbare UI-Elemente ohne Business-Logic\n\n#### Component Isolation\n- **Props-Based Configuration**: Alle Components konfigurierbar via Props\n- **No Global State**: State nur in `CostCalculator.tsx`, Props-Drilling f√ºr Steps\n- **Self-Contained**: Jede Component kann isoliert entwickelt/getestet werden\n\n#### Service Layer Separation\n- **Presentation**: Components (React)\n- **Business Logic**: Calculator Engine (Pure Functions)\n- **Data Access**: API Routes + Supabase Client\n- **Configuration**: Pricing Config (Static Data)\n\n#### Utility Modularity\n- **types.ts**: Nur Type Definitions\n- **validation-schemas.ts**: Nur Zod Schemas\n- **utils.ts**: Helper Functions (formatCurrency, formatDuration)\n- **calculator-engine.ts**: Calculation Functions\n\n---\n\n## Components and Interfaces\n\n### Core Components\n\n#### 1. CostCalculator.tsx (Main Container)\n\n**Purpose**: Zentraler State Container f√ºr gesamten Calculator Flow\n\n**Type Definition**:\n```typescript\ninterface CalculatorState {\n  // Step 1\n  projectType: ProjectType\n\n  // Step 2\n  designLevel: DesignLevel\n  pageRange: PageRange\n  responsiveness: ResponsivenessLevel\n  uxComplexity: UXComplexity\n\n  // Step 3\n  features: {\n    cms: boolean\n    cmsType?: CMSType\n    auth: boolean\n    auth2FA?: boolean\n    database: boolean\n    databaseComplexity?: DatabaseComplexity\n    payment: boolean\n    paymentProvider?: PaymentProvider\n    api: boolean\n    apiType?: APIType\n    thirdPartyIntegrations: boolean\n    integrationsCount?: number\n    fileUploads: boolean\n    i18n: boolean\n    i18nLanguages?: number\n    adminDashboard: boolean\n    realtime: boolean\n  }\n\n  // Step 4\n  quality: {\n    seo: SEOLevel\n    performance: PerformanceLevel\n    security: SecurityLevel\n    dsgvo: boolean\n    testing: TestingLevel\n    accessibility: AccessibilityLevel\n  }\n\n  // Step 5\n  timeline: {\n    projectStart: ProjectStart\n    maintenance: MaintenanceLevel\n    support: SupportDuration\n    hosting: boolean\n    training: boolean\n  }\n\n  // Current Step\n  currentStep: number\n}\n\ninterface ComparisonResult {\n  freelancer: ProviderEstimate\n  agency: ProviderEstimate\n  headon: ProviderEstimate\n  savings: {\n    vsFreelancer: { price: number; time: number }\n    vsAgency: { price: number; time: number }\n  }\n}\n\ninterface ProviderEstimate {\n  provider: 'freelancer' | 'agency' | 'headon'\n  price: {\n    min: number\n    max: number\n    avg: number\n  }\n  duration: {\n    min: number  // weeks\n    max: number\n  }\n  quality: 1 | 2 | 3 | 4 | 5\n  pros: string[]\n  cons: string[]\n  included: string[]\n  excluded: string[]\n}\n```\n\n**State Management**:\n```typescript\nconst [state, setState] = useState<CalculatorState>(defaultState)\nconst [comparison, setComparison] = useState<ComparisonResult | null>(null)\n\n// Derived State\nconst currentStepComponent = useMemo(() => {\n  return getStepComponent(state.currentStep)\n}, [state.currentStep])\n\n// Navigation\nconst handleNext = () => {\n  if (state.currentStep < 6) {\n    setState(prev => ({ ...prev, currentStep: prev.currentStep + 1 }))\n  }\n}\n\nconst handlePrev = () => {\n  if (state.currentStep > 1) {\n    setState(prev => ({ ...prev, currentStep: prev.currentStep - 1 }))\n  }\n}\n\n// Calculation\nuseEffect(() => {\n  if (state.currentStep === 6) {\n    const result = calculateComparison(state)\n    setComparison(result)\n  }\n}, [state, state.currentStep])\n```\n\n**Dependencies**:\n- Step Components\n- CalculatorProgress\n- PricePreview\n- Calculator Engine\n\n**Reuses**:\n- `AnimatePresence` from Framer Motion (wie MultiStepForm)\n- `cn()` from `@/lib/utils`\n\n---\n\n#### 2. CalculatorProgress.tsx\n\n**Purpose**: Visueller Progress Indicator (1/6, 2/6, ...)\n\n**Props Interface**:\n```typescript\ninterface CalculatorProgressProps {\n  currentStep: number\n  totalSteps: number\n  onStepClick?: (step: number) => void\n  allowBackNavigation?: boolean\n}\n```\n\n**Implementation Pattern**:\n```typescript\nexport function CalculatorProgress({\n  currentStep,\n  totalSteps,\n  onStepClick,\n  allowBackNavigation = true\n}: CalculatorProgressProps) {\n  return (\n    <div className=\"mb-8\">\n      <div className=\"flex items-center justify-between\">\n        {Array.from({ length: totalSteps }, (_, i) => i + 1).map((step) => (\n          <div key={step} className=\"flex flex-1 items-center\">\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{\n                scale: currentStep >= step ? 1 : 0.8,\n                backgroundColor: currentStep >= step ? '#fff' : 'rgba(255,255,255,0.2)',\n              }}\n              className=\"...\"\n              onClick={() => {\n                if (allowBackNavigation && step <= currentStep) {\n                  onStepClick?.(step)\n                }\n              }}\n            >\n              {currentStep > step ? <CheckCircle2 /> : <span>{step}</span>}\n            </motion.div>\n\n            {step < totalSteps && (\n              <motion.div className=\"progress-connector\">\n                <motion.div\n                  className=\"progress-fill\"\n                  animate={{ width: currentStep > step ? '100%' : '0%' }}\n                />\n              </motion.div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"text-center mt-4\">\n        <motion.div key={currentStep} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>\n          {stepLabels[currentStep]}\n        </motion.div>\n      </div>\n    </div>\n  )\n}\n```\n\n**Dependencies**: Framer Motion, Lucide Icons\n**Reuses**: Motion patterns from MultiStepForm Progress Bar\n\n---\n\n#### 3. PricePreview.tsx (Sticky Sidebar)\n\n**Purpose**: Live Preview der aktuellen Kostensch√§tzung\n\n**Props Interface**:\n```typescript\ninterface PricePreviewProps {\n  state: CalculatorState\n  className?: string\n}\n```\n\n**Implementation**:\n```typescript\nexport function PricePreview({ state, className }: PricePreviewProps) {\n  // Calculate in real-time\n  const estimate = useMemo(() => {\n    return calculateHeadonEstimate(state)\n  }, [state])\n\n  const breakdown = useMemo(() => {\n    return calculateBreakdown(state)\n  }, [state])\n\n  return (\n    <div className={cn(\"sticky top-24 space-y-6\", className)}>\n      <Card>\n        <CardHeader>\n          <CardTitle>Gesch√§tzte Kosten</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <PriceCounter\n            value={estimate.price.avg}\n            min={estimate.price.min}\n            max={estimate.price.max}\n          />\n\n          <div className=\"mt-4 flex items-center gap-2 text-muted-foreground\">\n            <Clock className=\"h-4 w-4\" />\n            <span>{formatDuration(estimate.duration)}</span>\n          </div>\n\n          <Separator className=\"my-6\" />\n\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium\">Aufschl√ºsselung:</h4>\n            {breakdown.map(item => (\n              <div key={item.label} className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">{item.label}</span>\n                <span className=\"font-medium\">{formatCurrency(item.value)}</span>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n```\n\n**Dependencies**:\n- Calculator Engine (`calculateHeadonEstimate`)\n- PriceCounter Component\n- shadcn/ui (Card, Separator)\n\n**Reuses**: `useMemo` for performance, `cn()` utility\n\n---\n\n### Step Components\n\n#### 4. StepProjectType.tsx\n\n**Purpose**: Projekttyp-Auswahl (Step 1)\n\n**Props Interface**:\n```typescript\ninterface StepProjectTypeProps {\n  value: ProjectType\n  onChange: (value: ProjectType) => void\n}\n\ntype ProjectType =\n  | 'website-simple'\n  | 'website-complex'\n  | 'web-app'\n  | 'mobile-app'\n  | 'ecommerce'\n  | 'custom'\n  | 'unsure'\n```\n\n**Implementation Pattern**:\n```typescript\nconst projectTypes = [\n  {\n    value: 'website-simple',\n    label: 'Website (Corporate)',\n    icon: Globe,\n    description: 'Pr√§senz-Website mit statischen Inhalten',\n    basePrice: { min: 2500, max: 8000 },\n  },\n  // ... more types\n] as const\n\nexport function StepProjectType({ value, onChange }: StepProjectTypeProps) {\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center mb-8\">\n        <h3 className=\"text-2xl font-bold\">Was m√∂chten Sie entwickeln lassen?</h3>\n        <p className=\"text-muted-foreground\">W√§hlen Sie den passenden Projekt-Typ</p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {projectTypes.map((type, index) => (\n          <motion.div\n            key={type.value}\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: index * 0.1 }}\n          >\n            <ProjectTypeCard\n              {...type}\n              selected={value === type.value}\n              onClick={() => onChange(type.value)}\n            />\n          </motion.div>\n        ))}\n      </div>\n    </div>\n  )\n}\n```\n\n**Dependencies**: ProjectTypeCard (shared component)\n**Reuses**: Framer Motion stagger pattern\n\n---\n\n#### 5. StepDesignScope.tsx\n\n**Purpose**: Design Level & Projekt-Umfang (Step 2)\n\n**Props Interface**:\n```typescript\ninterface StepDesignScopeProps {\n  designLevel: DesignLevel\n  pageRange: PageRange\n  responsiveness: ResponsivenessLevel\n  uxComplexity: UXComplexity\n  onChange: (updates: Partial<CalculatorState>) => void\n}\n\ntype DesignLevel = 'template' | 'custom' | 'premium'\ntype PageRange = '1-5' | '6-15' | '16-30' | '30+'\ntype ResponsivenessLevel = 'desktop-only' | 'responsive' | 'pwa'\ntype UXComplexity = 'standard' | 'advanced' | 'premium'\n```\n\n**Key Features**:\n- Radio Cards f√ºr Design Level (1.0x, 1.5x, 2.0x)\n- Range Slider f√ºr Seiten-Anzahl (Custom Component)\n- Select Dropdown f√ºr Responsiveness\n- Radio Group f√ºr UX-Komplexit√§t\n\n**Reuses**:\n- `RadioGroup` from shadcn/ui\n- `Select` from shadcn/ui\n- Custom `RangeSlider` component\n\n---\n\n#### 6. StepFeatures.tsx\n\n**Purpose**: Feature-Auswahl mit Conditional Sub-Options (Step 3)\n\n**Props Interface**:\n```typescript\ninterface StepFeaturesProps {\n  features: CalculatorState['features']\n  onChange: (features: CalculatorState['features']) => void\n}\n```\n\n**Implementation Pattern**:\n```typescript\nexport function StepFeatures({ features, onChange }: StepFeaturesProps) {\n  const handleFeatureToggle = (key: keyof typeof features) => {\n    onChange({ ...features, [key]: !features[key] })\n  }\n\n  const handleSubOptionChange = (key: string, value: any) => {\n    onChange({ ...features, [key]: value })\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* CMS Feature with Sub-Options */}\n      <FeatureCheckbox\n        label=\"Content Management System (CMS)\"\n        checked={features.cms}\n        onChange={() => handleFeatureToggle('cms')}\n        price={{ min: 1500, max: 3500 }}\n      />\n\n      <AnimatePresence>\n        {features.cms && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"ml-8\"\n          >\n            <RadioGroup\n              value={features.cmsType}\n              onValueChange={(val) => handleSubOptionChange('cmsType', val)}\n            >\n              <RadioGroupItem value=\"strapi\">Strapi (+1.500‚Ç¨)</RadioGroupItem>\n              <RadioGroupItem value=\"sanity\">Sanity (+2.000‚Ç¨)</RadioGroupItem>\n              <RadioGroupItem value=\"custom\">Custom CMS (+3.500‚Ç¨)</RadioGroupItem>\n            </RadioGroup>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* More Features... */}\n    </div>\n  )\n}\n```\n\n**Dependencies**:\n- `FeatureCheckbox` (shared component)\n- `RadioGroup` from shadcn/ui\n- `AnimatePresence` from Framer Motion\n\n**Reuses**: Conditional rendering pattern with AnimatePresence\n\n---\n\n#### 7. StepQuality.tsx\n\n**Purpose**: Qualit√§t & Performance-Optionen (Step 4)\n\n**Props Interface**:\n```typescript\ninterface StepQualityProps {\n  quality: CalculatorState['quality']\n  onChange: (quality: CalculatorState['quality']) => void\n}\n```\n\n**Implementation**:\n```typescript\nexport function StepQuality({ quality, onChange }: StepQualityProps) {\n  return (\n    <Accordion type=\"multiple\" className=\"w-full\">\n      <AccordionItem value=\"seo\">\n        <AccordionTrigger>\n          <div className=\"flex items-center gap-2\">\n            <Search className=\"h-5 w-5\" />\n            SEO-Optimierung\n          </div>\n        </AccordionTrigger>\n        <AccordionContent>\n          <RadioGroup\n            value={quality.seo}\n            onValueChange={(val) => onChange({ ...quality, seo: val as SEOLevel })}\n          >\n            <RadioGroupItem value=\"none\">Keine (+0‚Ç¨)</RadioGroupItem>\n            <RadioGroupItem value=\"basic\">\n              Basic (+1.000‚Ç¨)\n              <p className=\"text-sm text-muted-foreground\">Meta, Sitemap, Robots</p>\n            </RadioGroupItem>\n            <RadioGroupItem value=\"advanced\">\n              Advanced (+2.500‚Ç¨)\n              <p className=\"text-sm text-muted-foreground\">\n                Schema.org, Performance, Analytics\n              </p>\n            </RadioGroupItem>\n            <RadioGroupItem value=\"enterprise\">\n              Enterprise (+5.000‚Ç¨)\n              <p className=\"text-sm text-muted-foreground\">\n                Technical SEO Audit, Ongoing\n              </p>\n            </RadioGroupItem>\n          </RadioGroup>\n        </AccordionContent>\n      </AccordionItem>\n\n      {/* Performance, Security, DSGVO, Testing, Accessibility... */}\n    </Accordion>\n  )\n}\n```\n\n**Dependencies**: `Accordion`, `RadioGroup` from shadcn/ui\n**Reuses**: Accordion pattern f√ºr kategorisierte Optionen\n\n---\n\n#### 8. StepTimeline.tsx\n\n**Purpose**: Timeline & Support-Konfiguration (Step 5)\n\n**Implementation Pattern**:\n- Radio Cards f√ºr Projektstart (Normal, Urgent 1.3x)\n- Radio Cards f√ºr Wartung (Keine, Basic +150‚Ç¨/mo, Premium +350‚Ç¨/mo)\n- Select f√ºr Support-Dauer (3/6/12 Monate)\n- Switch Toggle f√ºr Managed Hosting (+50‚Ç¨/mo)\n- Checkbox f√ºr Training (+800‚Ç¨)\n\n**Reuses**:\n- `Switch` from shadcn/ui\n- `Select` from shadcn/ui\n- Radio Card pattern from Step 1\n\n---\n\n### Results Components\n\n#### 9. ComparisonGrid.tsx\n\n**Purpose**: 3-Column Comparison Layout (Desktop) / Tabs (Mobile)\n\n**Props Interface**:\n```typescript\ninterface ComparisonGridProps {\n  comparison: ComparisonResult\n  isMobile?: boolean\n}\n```\n\n**Implementation**:\n```typescript\nexport function ComparisonGrid({ comparison, isMobile }: ComparisonGridProps) {\n  if (isMobile) {\n    return (\n      <Tabs defaultValue=\"headon\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"freelancer\">Freelancer</TabsTrigger>\n          <TabsTrigger value=\"agency\">Agentur</TabsTrigger>\n          <TabsTrigger value=\"headon\">HEADON ‚≠ê</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"freelancer\">\n          <ComparisonCard provider={comparison.freelancer} />\n        </TabsContent>\n        <TabsContent value=\"agency\">\n          <ComparisonCard provider={comparison.agency} />\n        </TabsContent>\n        <TabsContent value=\"headon\">\n          <ComparisonCard provider={comparison.headon} highlight />\n        </TabsContent>\n      </Tabs>\n    )\n  }\n\n  return (\n    <div className=\"grid gap-6 md:grid-cols-3\">\n      <ComparisonCard provider={comparison.freelancer} />\n      <ComparisonCard provider={comparison.agency} />\n      <ComparisonCard provider={comparison.headon} highlight />\n    </div>\n  )\n}\n```\n\n**Dependencies**:\n- `ComparisonCard` component\n- `Tabs` from shadcn/ui\n\n**Reuses**: Responsive pattern (Grid ‚Üí Tabs)\n\n---\n\n#### 10. ComparisonCard.tsx\n\n**Purpose**: Single Provider Card (Freelancer/Agentur/HEADON)\n\n**Props Interface**:\n```typescript\ninterface ComparisonCardProps {\n  provider: ProviderEstimate\n  highlight?: boolean\n}\n```\n\n**Implementation**:\n```typescript\nexport function ComparisonCard({ provider, highlight }: ComparisonCardProps) {\n  return (\n    <Card className={cn(\n      \"relative overflow-hidden\",\n      highlight && \"border-primary-600 border-2 shadow-xl\"\n    )}>\n      {highlight && (\n        <div className=\"absolute top-0 right-0 bg-primary-600 text-white px-4 py-1 text-sm font-bold\">\n          ‚≠ê BESTE WAHL\n        </div>\n      )}\n\n      <CardHeader>\n        <CardTitle className=\"capitalize\">{provider.provider}</CardTitle>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* Price */}\n        <div>\n          <div className=\"text-3xl font-bold\">\n            {formatCurrency(provider.price.avg)}\n          </div>\n          <div className=\"text-sm text-muted-foreground\">\n            {formatCurrency(provider.price.min)} - {formatCurrency(provider.price.max)}\n          </div>\n        </div>\n\n        {/* Duration */}\n        <div className=\"flex items-center gap-2\">\n          <Clock className=\"h-4 w-4\" />\n          <span>{formatDuration(provider.duration)}</span>\n        </div>\n\n        {/* Quality Stars */}\n        <div className=\"flex gap-1\">\n          {Array.from({ length: 5 }, (_, i) => (\n            <Star\n              key={i}\n              className={cn(\n                \"h-5 w-5\",\n                i < provider.quality ? \"fill-yellow-400 text-yellow-400\" : \"text-gray-300\"\n              )}\n            />\n          ))}\n        </div>\n\n        <Separator />\n\n        {/* Pros */}\n        <div className=\"space-y-2\">\n          {provider.pros.map((pro, i) => (\n            <div key={i} className=\"flex items-start gap-2 text-sm\">\n              <Check className=\"h-4 w-4 text-green-600 mt-0.5\" />\n              <span>{pro}</span>\n            </div>\n          ))}\n        </div>\n\n        {/* Cons */}\n        {provider.cons.length > 0 && (\n          <div className=\"space-y-2\">\n            {provider.cons.map((con, i) => (\n              <div key={i} className=\"flex items-start gap-2 text-sm\">\n                <AlertCircle className=\"h-4 w-4 text-orange-600 mt-0.5\" />\n                <span>{con}</span>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n```\n\n**Dependencies**: shadcn/ui (Card, Separator), Lucide Icons\n**Reuses**: `cn()`, `formatCurrency()`, `formatDuration()`\n\n---\n\n#### 11. SavingsHighlight.tsx\n\n**Purpose**: Savings Badge (\"üí∞ Sie sparen mit HEADON...\")\n\n**Props Interface**:\n```typescript\ninterface SavingsHighlightProps {\n  savings: ComparisonResult['savings']\n}\n```\n\n**Implementation**:\n```typescript\nexport function SavingsHighlight({ savings }: SavingsHighlightProps) {\n  const totalSavingsVsAgency = savings.vsAgency.price\n  const timeSavingsVsAgency = savings.vsAgency.time\n\n  return (\n    <motion.div\n      initial={{ scale: 0.9, opacity: 0 }}\n      animate={{ scale: 1, opacity: 1 }}\n      className=\"text-center py-8 px-6 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl\"\n    >\n      <div className=\"text-4xl mb-2\">üí∞</div>\n      <h3 className=\"text-2xl font-bold text-green-900 mb-2\">\n        Sie sparen mit HEADON:\n      </h3>\n      <div className=\"text-3xl font-extrabold text-green-700\">\n        {formatCurrency(totalSavingsVsAgency)} & {timeSavingsVsAgency} Wochen\n      </div>\n      <p className=\"text-sm text-green-800 mt-4\">\n        Im Vergleich zu traditionellen Agenturen\n      </p>\n    </motion.div>\n  )\n}\n```\n\n**Dependencies**: Framer Motion\n**Reuses**: Motion scale animation\n\n---\n\n#### 12. PriceBreakdown.tsx\n\n**Purpose**: Detaillierte Kosten-Aufschl√ºsselung\n\n**Props Interface**:\n```typescript\ninterface PriceBreakdownProps {\n  state: CalculatorState\n  breakdown: BreakdownItem[]\n}\n\ninterface BreakdownItem {\n  category: string\n  items: { label: string; value: number }[]\n  subtotal: number\n}\n```\n\n**Implementation**:\n```typescript\nexport function PriceBreakdown({ state, breakdown }: PriceBreakdownProps) {\n  return (\n    <Accordion type=\"single\" collapsible className=\"w-full\">\n      <AccordionItem value=\"breakdown\">\n        <AccordionTrigger>\n          <div className=\"flex items-center gap-2\">\n            <Calculator className=\"h-5 w-5\" />\n            Detaillierte Aufschl√ºsselung\n          </div>\n        </AccordionTrigger>\n        <AccordionContent>\n          <div className=\"space-y-6\">\n            {breakdown.map((category) => (\n              <div key={category.category}>\n                <h4 className=\"font-semibold mb-3\">{category.category}</h4>\n                <div className=\"space-y-2\">\n                  {category.items.map((item) => (\n                    <div key={item.label} className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">{item.label}</span>\n                      <span className=\"font-medium\">{formatCurrency(item.value)}</span>\n                    </div>\n                  ))}\n                </div>\n                <Separator className=\"my-3\" />\n                <div className=\"flex justify-between font-semibold\">\n                  <span>Zwischensumme</span>\n                  <span>{formatCurrency(category.subtotal)}</span>\n                </div>\n              </div>\n            ))}\n\n            <Separator className=\"my-4\" />\n\n            <div className=\"flex justify-between text-lg font-bold\">\n              <span>Gesamtkosten (HEADON)</span>\n              <span className=\"text-primary-600\">\n                {formatCurrency(calculateTotal(breakdown))}\n              </span>\n            </div>\n          </div>\n        </AccordionContent>\n      </AccordionItem>\n    </Accordion>\n  )\n}\n```\n\n**Dependencies**: `Accordion` from shadcn/ui\n**Reuses**: Accordion expandable pattern\n\n---\n\n#### 13. LeadCaptureDialog.tsx\n\n**Purpose**: Optional Lead-Form f√ºr detailliertes Angebot\n\n**Props Interface**:\n```typescript\ninterface LeadCaptureDialogProps {\n  state: CalculatorState\n  comparison: ComparisonResult\n  onSubmit: (leadData: LeadData) => Promise<void>\n}\n\ninterface LeadData {\n  name: string\n  email: string\n  phone?: string\n  message?: string\n  preferredProvider: 'freelancer' | 'agency' | 'headon'\n}\n```\n\n**Implementation Pattern** (Similar to MultiStepForm):\n```typescript\nexport function LeadCaptureDialog({ state, comparison, onSubmit }: LeadCaptureDialogProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [formData, setFormData] = useState<LeadData>({\n    name: '',\n    email: '',\n    phone: '',\n    message: '',\n    preferredProvider: 'headon',\n  })\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setIsSubmitting(true)\n\n    try {\n      await onSubmit(formData)\n      setIsOpen(false)\n      toast.success('Vielen Dank! Wir melden uns innerhalb von 24 Stunden.')\n    } catch (error) {\n      toast.error('Fehler beim Senden. Bitte versuchen Sie es erneut.')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button size=\"lg\" className=\"w-full\">\n          üìß Detailliertes Angebot per E-Mail\n        </Button>\n      </DialogTrigger>\n\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Kostenloses Angebot anfordern</DialogTitle>\n          <DialogDescription>\n            Wir senden Ihnen Ihre pers√∂nliche Kostensch√§tzung per E-Mail zu.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"name\">Name *</Label>\n            <Input\n              id=\"name\"\n              required\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"email\">E-Mail *</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              required\n              value={formData.email}\n              onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"phone\">Telefon (optional)</Label>\n            <Input\n              id=\"phone\"\n              type=\"tel\"\n              value={formData.phone}\n              onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"message\">Zus√§tzliche Informationen (optional)</Label>\n            <Textarea\n              id=\"message\"\n              rows={3}\n              value={formData.message}\n              onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n            />\n          </div>\n\n          <div>\n            <Label>Bevorzugter Anbieter</Label>\n            <Select\n              value={formData.preferredProvider}\n              onValueChange={(val) => setFormData({ ...formData, preferredProvider: val as any })}\n            >\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"freelancer\">Freelancer</SelectItem>\n                <SelectItem value=\"agency\">Agentur</SelectItem>\n                <SelectItem value=\"headon\">HEADON (empfohlen)</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <DialogFooter>\n            <Button type=\"submit\" disabled={isSubmitting} className=\"w-full\">\n              {isSubmitting ? 'Wird gesendet...' : 'Angebot anfordern'}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  )\n}\n```\n\n**Dependencies**:\n- `Dialog`, `Input`, `Textarea`, `Select` from shadcn/ui\n- `toast` from Sonner\n\n**Reuses**:\n- Form pattern from MultiStepForm\n- Validation similar to `lib/validations.ts`\n\n---\n\n### Shared Components\n\n#### 14. ProjectTypeCard.tsx\n\n**Purpose**: Icon Card f√ºr Projekttyp-Auswahl\n\n**Props Interface**:\n```typescript\ninterface ProjectTypeCardProps {\n  value: string\n  label: string\n  description: string\n  icon: LucideIcon\n  selected: boolean\n  onClick: () => void\n  basePrice?: { min: number; max: number }\n}\n```\n\n**Implementation**:\n```typescript\nexport function ProjectTypeCard({\n  label,\n  description,\n  icon: Icon,\n  selected,\n  onClick,\n  basePrice,\n}: ProjectTypeCardProps) {\n  return (\n    <motion.div\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n      onClick={onClick}\n      className={cn(\n        \"relative cursor-pointer rounded-xl p-6 border-2 transition-all\",\n        selected\n          ? \"border-primary-600 bg-primary-50 shadow-lg\"\n          : \"border-gray-200 bg-white hover:border-primary-300\"\n      )}\n    >\n      <div className=\"flex items-start gap-4\">\n        <div className={cn(\n          \"h-14 w-14 rounded-lg flex items-center justify-center\",\n          selected ? \"bg-primary-600 text-white\" : \"bg-gray-100 text-gray-600\"\n        )}>\n          <Icon className=\"h-7 w-7\" />\n        </div>\n\n        <div className=\"flex-1\">\n          <h4 className=\"font-semibold text-lg mb-1\">{label}</h4>\n          <p className=\"text-sm text-muted-foreground\">{description}</p>\n\n          {basePrice && (\n            <div className=\"mt-3 text-sm font-medium text-primary-600\">\n              ab {formatCurrency(basePrice.min)}\n            </div>\n          )}\n        </div>\n\n        {selected && (\n          <CheckCircle2 className=\"h-6 w-6 text-primary-600 flex-shrink-0\" />\n        )}\n      </div>\n    </motion.div>\n  )\n}\n```\n\n**Dependencies**: Framer Motion, Lucide Icons\n**Reuses**: `cn()`, `formatCurrency()`, Motion hover effects\n\n---\n\n#### 15. FeatureCheckbox.tsx\n\n**Purpose**: Checkbox mit Preis-Badge f√ºr Features\n\n**Props Interface**:\n```typescript\ninterface FeatureCheckboxProps {\n  label: string\n  description?: string\n  checked: boolean\n  onChange: (checked: boolean) => void\n  price?: { min: number; max: number } | number\n  icon?: LucideIcon\n}\n```\n\n**Implementation**:\n```typescript\nexport function FeatureCheckbox({\n  label,\n  description,\n  checked,\n  onChange,\n  price,\n  icon: Icon,\n}: FeatureCheckboxProps) {\n  const priceDisplay = typeof price === 'number'\n    ? formatCurrency(price)\n    : price\n      ? `${formatCurrency(price.min)} - ${formatCurrency(price.max)}`\n      : null\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-4 p-4 rounded-lg border-2 transition-all cursor-pointer\",\n        checked\n          ? \"border-primary-600 bg-primary-50\"\n          : \"border-gray-200 hover:border-primary-300\"\n      )}\n      onClick={() => onChange(!checked)}\n    >\n      <Checkbox checked={checked} onCheckedChange={onChange} />\n\n      {Icon && (\n        <div className=\"h-10 w-10 rounded-lg bg-primary-100 text-primary-600 flex items-center justify-center\">\n          <Icon className=\"h-5 w-5\" />\n        </div>\n      )}\n\n      <div className=\"flex-1\">\n        <div className=\"font-medium\">{label}</div>\n        {description && (\n          <div className=\"text-sm text-muted-foreground\">{description}</div>\n        )}\n      </div>\n\n      {priceDisplay && (\n        <Badge variant={checked ? \"default\" : \"secondary\"}>\n          {priceDisplay}\n        </Badge>\n      )}\n    </div>\n  )\n}\n```\n\n**Dependencies**: `Checkbox`, `Badge` from shadcn/ui\n**Reuses**: `cn()`, `formatCurrency()`\n\n---\n\n#### 16. RangeSlider.tsx\n\n**Purpose**: Custom Range Slider mit visueller Anzeige\n\n**Props Interface**:\n```typescript\ninterface RangeSliderProps {\n  value: number\n  onChange: (value: number) => void\n  min: number\n  max: number\n  step: number\n  labels?: string[]\n  formatLabel?: (value: number) => string\n}\n```\n\n**Implementation**:\n```typescript\nexport function RangeSlider({\n  value,\n  onChange,\n  min,\n  max,\n  step,\n  labels,\n  formatLabel = (v) => String(v),\n}: RangeSliderProps) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between text-sm\">\n        {labels?.map((label, i) => (\n          <span key={i} className={cn(\n            \"text-muted-foreground\",\n            value === min + i * step && \"text-primary-600 font-semibold\"\n          )}>\n            {label}\n          </span>\n        ))}\n      </div>\n\n      <Slider\n        value={[value]}\n        onValueChange={([val]) => onChange(val)}\n        min={min}\n        max={max}\n        step={step}\n        className=\"w-full\"\n      />\n\n      <div className=\"text-center\">\n        <div className=\"text-2xl font-bold text-primary-600\">\n          {formatLabel(value)}\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\n**Dependencies**: `Slider` from shadcn/ui\n**Reuses**: `cn()`\n\n---\n\n#### 17. PriceCounter.tsx\n\n**Purpose**: Animated Number Counter f√ºr Preis-Updates\n\n**Props Interface**:\n```typescript\ninterface PriceCounterProps {\n  value: number\n  min?: number\n  max?: number\n  duration?: number\n  className?: string\n}\n```\n\n**Implementation**:\n```typescript\nimport { useSpring, animated } from '@react-spring/web'\n\nexport function PriceCounter({\n  value,\n  min,\n  max,\n  duration = 1000,\n  className\n}: PriceCounterProps) {\n  const { number } = useSpring({\n    from: { number: 0 },\n    number: value,\n    delay: 200,\n    config: { mass: 1, tension: 20, friction: 10 },\n  })\n\n  return (\n    <div className={cn(\"space-y-2\", className)}>\n      <animated.div className=\"text-4xl font-bold text-primary-600\">\n        {number.to((n) => formatCurrency(Math.round(n)))}\n      </animated.div>\n\n      {min !== undefined && max !== undefined && (\n        <div className=\"text-sm text-muted-foreground\">\n          {formatCurrency(min)} - {formatCurrency(max)}\n        </div>\n      )}\n    </div>\n  )\n}\n```\n\n**Dependencies**: `@react-spring/web` (alternative zu Framer Motion f√ºr numbers)\n**Reuses**: `formatCurrency()`, `cn()`\n\n**Note**: Wenn `@react-spring/web` nicht gew√ºnscht, kann auch mit `useEffect` + `setInterval` implementiert werden\n\n---\n\n## Data Models\n\n### TypeScript Interfaces\n\n#### Calculator State\n```typescript\n// lib/calculator/types.ts\n\nexport type ProjectType =\n  | 'website-simple'\n  | 'website-complex'\n  | 'web-app'\n  | 'mobile-app'\n  | 'ecommerce'\n  | 'custom'\n  | 'unsure'\n\nexport type DesignLevel = 'template' | 'custom' | 'premium'\nexport type PageRange = '1-5' | '6-15' | '16-30' | '30+'\nexport type ResponsivenessLevel = 'desktop-only' | 'responsive' | 'pwa'\nexport type UXComplexity = 'standard' | 'advanced' | 'premium'\n\nexport type CMSType = 'strapi' | 'sanity' | 'custom'\nexport type DatabaseComplexity = 'simple' | 'complex'\nexport type PaymentProvider = 'stripe' | 'paypal' | 'mollie'\nexport type APIType = 'rest' | 'graphql'\n\nexport type SEOLevel = 'none' | 'basic' | 'advanced' | 'enterprise'\nexport type PerformanceLevel = 'standard' | 'optimized' | 'premium'\nexport type SecurityLevel = 'ssl-only' | 'advanced' | 'penetration-testing'\nexport type TestingLevel = 'none' | 'unit' | 'e2e' | 'qa-process'\nexport type AccessibilityLevel = 'none' | 'wcag-aa' | 'wcag-aaa'\n\nexport type ProjectStart = 'flexible' | 'normal' | 'urgent'\nexport type MaintenanceLevel = 'none' | 'basic' | 'premium'\nexport type SupportDuration = 'none' | '3-months' | '6-months' | '12-months'\n\nexport interface CalculatorState {\n  // Step 1\n  projectType: ProjectType\n\n  // Step 2\n  design: {\n    level: DesignLevel\n    pageRange: PageRange\n    responsiveness: ResponsivenessLevel\n    uxComplexity: UXComplexity\n  }\n\n  // Step 3\n  features: {\n    cms: boolean\n    cmsType?: CMSType\n    auth: boolean\n    auth2FA?: boolean\n    authSocial?: boolean\n    database: boolean\n    databaseComplexity?: DatabaseComplexity\n    payment: boolean\n    paymentProvider?: PaymentProvider\n    api: boolean\n    apiType?: APIType\n    thirdPartyIntegrations: boolean\n    integrationsCount?: number\n    fileUploads: boolean\n    i18n: boolean\n    i18nLanguages?: number\n    adminDashboard: boolean\n    realtime: boolean\n  }\n\n  // Step 4\n  quality: {\n    seo: SEOLevel\n    performance: PerformanceLevel\n    security: SecurityLevel\n    dsgvo: boolean\n    testing: TestingLevel\n    accessibility: AccessibilityLevel\n  }\n\n  // Step 5\n  timeline: {\n    projectStart: ProjectStart\n    maintenance: MaintenanceLevel\n    support: SupportDuration\n    hosting: boolean\n    training: boolean\n  }\n\n  // Navigation\n  currentStep: number\n}\n\nexport interface PriceRange {\n  min: number\n  max: number\n  avg: number\n}\n\nexport interface DurationRange {\n  min: number  // weeks\n  max: number\n}\n\nexport interface ProviderEstimate {\n  provider: 'freelancer' | 'agency' | 'headon'\n  price: PriceRange\n  duration: DurationRange\n  quality: 1 | 2 | 3 | 4 | 5\n  pros: string[]\n  cons: string[]\n  included: string[]\n  excluded: string[]\n}\n\nexport interface ComparisonResult {\n  freelancer: ProviderEstimate\n  agency: ProviderEstimate\n  headon: ProviderEstimate\n  savings: {\n    vsFreelancer: {\n      price: number\n      time: number  // weeks\n    }\n    vsAgency: {\n      price: number\n      time: number\n    }\n  }\n}\n\nexport interface BreakdownItem {\n  label: string\n  value: number\n}\n\nexport interface BreakdownCategory {\n  category: string\n  items: BreakdownItem[]\n  subtotal: number\n}\n\nexport interface LeadData {\n  name: string\n  email: string\n  phone?: string\n  message?: string\n  preferredProvider: 'freelancer' | 'agency' | 'headon'\n}\n```\n\n### Supabase Database Schema\n\n#### Table: calculator_leads\n\n```sql\nCREATE TABLE calculator_leads (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n\n  -- Lead Contact Info\n  name TEXT NOT NULL,\n  email TEXT NOT NULL,\n  phone TEXT,\n  company TEXT,\n  message TEXT,\n\n  -- Calculator Data (JSONB)\n  calculator_data JSONB NOT NULL,\n  -- Structure: CalculatorState (entire state object)\n\n  -- Comparison Result (JSONB)\n  comparison_result JSONB NOT NULL,\n  -- Structure: ComparisonResult (full comparison output)\n\n  -- Preferences\n  preferred_provider TEXT CHECK (preferred_provider IN ('freelancer', 'agency', 'headon')),\n\n  -- Scoring\n  lead_score INTEGER,\n  estimated_value INTEGER, -- Average price in cents (12500.00 ‚Üí 1250000)\n\n  -- Status\n  status TEXT DEFAULT 'new' CHECK (status IN ('new', 'contacted', 'qualified', 'converted', 'lost')),\n\n  -- UTM Tracking\n  utm_source TEXT,\n  utm_medium TEXT,\n  utm_campaign TEXT,\n  referrer TEXT,\n  user_agent TEXT,\n\n  -- Indexes\n  CONSTRAINT calculator_leads_email_check CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,}$')\n);\n\n-- Indexes\nCREATE INDEX idx_calculator_leads_email ON calculator_leads(email);\nCREATE INDEX idx_calculator_leads_created_at ON calculator_leads(created_at DESC);\nCREATE INDEX idx_calculator_leads_status ON calculator_leads(status);\nCREATE INDEX idx_calculator_leads_lead_score ON calculator_leads(lead_score DESC);\nCREATE INDEX idx_calculator_leads_preferred_provider ON calculator_leads(preferred_provider);\n\n-- Row Level Security (RLS)\nALTER TABLE calculator_leads ENABLE ROW LEVEL SECURITY;\n\n-- Policy: Only service role can access\nCREATE POLICY \"Service role can access all calculator_leads\"\n  ON calculator_leads\n  FOR ALL\n  USING (auth.role() = 'service_role');\n```\n\n#### Table: calculator_sessions (Optional - Anonymous Tracking)\n\n```sql\nCREATE TABLE calculator_sessions (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW(),\n\n  -- Session ID (f√ºr URL Sharing)\n  session_id TEXT UNIQUE NOT NULL,\n\n  -- Calculator Data (JSONB)\n  calculator_data JSONB,\n  comparison_result JSONB,\n\n  -- Progress Tracking\n  completed BOOLEAN DEFAULT FALSE,\n  step_reached INTEGER DEFAULT 1,\n\n  -- Anonyme Metadata\n  utm_source TEXT,\n  referrer TEXT,\n  user_agent TEXT,\n\n  -- Expiration\n  expires_at TIMESTAMPTZ DEFAULT NOW() + INTERVAL '30 days'\n);\n\n-- Indexes\nCREATE INDEX idx_calculator_sessions_session_id ON calculator_sessions(session_id);\nCREATE INDEX idx_calculator_sessions_created_at ON calculator_sessions(created_at DESC);\nCREATE INDEX idx_calculator_sessions_completed ON calculator_sessions(completed);\n\n-- Auto-Cleanup (Delete expired sessions)\nCREATE OR REPLACE FUNCTION delete_expired_calculator_sessions()\nRETURNS void AS $$\nBEGIN\n  DELETE FROM calculator_sessions WHERE expires_at < NOW();\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Run cleanup daily via pg_cron (optional)\n```\n\n### Zod Validation Schemas\n\n```typescript\n// lib/calculator/validation-schemas.ts\nimport { z } from 'zod'\n\n// Calculator State Schema\nexport const calculatorStateSchema = z.object({\n  projectType: z.enum([\n    'website-simple',\n    'website-complex',\n    'web-app',\n    'mobile-app',\n    'ecommerce',\n    'custom',\n    'unsure',\n  ]),\n\n  design: z.object({\n    level: z.enum(['template', 'custom', 'premium']),\n    pageRange: z.enum(['1-5', '6-15', '16-30', '30+']),\n    responsiveness: z.enum(['desktop-only', 'responsive', 'pwa']),\n    uxComplexity: z.enum(['standard', 'advanced', 'premium']),\n  }),\n\n  features: z.object({\n    cms: z.boolean(),\n    cmsType: z.enum(['strapi', 'sanity', 'custom']).optional(),\n    auth: z.boolean(),\n    auth2FA: z.boolean().optional(),\n    authSocial: z.boolean().optional(),\n    database: z.boolean(),\n    databaseComplexity: z.enum(['simple', 'complex']).optional(),\n    payment: z.boolean(),\n    paymentProvider: z.enum(['stripe', 'paypal', 'mollie']).optional(),\n    api: z.boolean(),\n    apiType: z.enum(['rest', 'graphql']).optional(),\n    thirdPartyIntegrations: z.boolean(),\n    integrationsCount: z.number().int().min(0).max(20).optional(),\n    fileUploads: z.boolean(),\n    i18n: z.boolean(),\n    i18nLanguages: z.number().int().min(1).max(20).optional(),\n    adminDashboard: z.boolean(),\n    realtime: z.boolean(),\n  }),\n\n  quality: z.object({\n    seo: z.enum(['none', 'basic', 'advanced', 'enterprise']),\n    performance: z.enum(['standard', 'optimized', 'premium']),\n    security: z.enum(['ssl-only', 'advanced', 'penetration-testing']),\n    dsgvo: z.boolean(),\n    testing: z.enum(['none', 'unit', 'e2e', 'qa-process']),\n    accessibility: z.enum(['none', 'wcag-aa', 'wcag-aaa']),\n  }),\n\n  timeline: z.object({\n    projectStart: z.enum(['flexible', 'normal', 'urgent']),\n    maintenance: z.enum(['none', 'basic', 'premium']),\n    support: z.enum(['none', '3-months', '6-months', '12-months']),\n    hosting: z.boolean(),\n    training: z.boolean(),\n  }),\n\n  currentStep: z.number().int().min(1).max(6),\n})\n\nexport type CalculatorStateType = z.infer<typeof calculatorStateSchema>\n\n// Lead Capture Schema\nexport const leadCaptureSchema = z.object({\n  name: z.string().min(2, 'Name muss mindestens 2 Zeichen haben').max(100),\n  email: z.string().email('Bitte geben Sie eine g√ºltige E-Mail-Adresse ein'),\n  phone: z\n    .string()\n    .optional()\n    .refine(\n      (val) =>\n        !val || /^[+]?[(]?[0-9]{1,4}[)]?[-\\s.]?[(]?[0-9]{1,4}[)]?[-\\s.]?[0-9]{1,9}$/im.test(val),\n      'Bitte geben Sie eine g√ºltige Telefonnummer ein'\n    ),\n  message: z.string().max(2000, 'Nachricht darf maximal 2000 Zeichen haben').optional(),\n  preferredProvider: z.enum(['freelancer', 'agency', 'headon']),\n})\n\nexport type LeadCaptureType = z.infer<typeof leadCaptureSchema>\n\n// API Request Schema\nexport const calculatorAPISchema = z.object({\n  leadData: leadCaptureSchema,\n  calculatorData: calculatorStateSchema,\n  comparisonResult: z.object({\n    freelancer: z.any(), // ProviderEstimate\n    agency: z.any(),\n    headon: z.any(),\n    savings: z.object({\n      vsFreelancer: z.object({ price: z.number(), time: z.number() }),\n      vsAgency: z.object({ price: z.number(), time: z.number() }),\n    }),\n  }),\n})\n\nexport type CalculatorAPIType = z.infer<typeof calculatorAPISchema>\n```\n\n---\n\n## Error Handling\n\n### Error Scenarios\n\n#### 1. Invalid Calculator State\n\n**Scenario**: User manipulates URL Query Params mit ung√ºltigen Daten\n\n**Handling**:\n```typescript\n// components/calculator/CostCalculator.tsx\nuseEffect(() => {\n  try {\n    const queryState = parseQueryParams(searchParams)\n    const validated = calculatorStateSchema.parse(queryState)\n    setState(validated)\n  } catch (error) {\n    console.error('Invalid state in URL:', error)\n    // Reset to default state\n    setState(defaultCalculatorState)\n    toast.error('Ung√ºltige Daten in URL. Calculator wurde zur√ºckgesetzt.')\n  }\n}, [searchParams])\n```\n\n**User Impact**: Calculator zeigt default State, Toast Notification\n\n---\n\n#### 2. API Route Errors\n\n**Scenario**: Supabase oder Resend API fehlschl√§gt\n\n**Handling**:\n```typescript\n// app/api/calculator/route.ts\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n\n    // Validate\n    const validated = calculatorAPISchema.parse(body)\n\n    // Save to Supabase\n    const { data, error: supabaseError } = await supabase\n      .from('calculator_leads')\n      .insert([leadData])\n      .select()\n\n    if (supabaseError) {\n      console.error('Supabase error:', supabaseError)\n      return NextResponse.json(\n        { error: 'Fehler beim Speichern der Anfrage' },\n        { status: 500 }\n      )\n    }\n\n    // Send Email (non-blocking)\n    try {\n      await sendNotificationEmail(leadData)\n    } catch (emailError) {\n      console.error('Email error:', emailError)\n      // Don't block - lead is saved\n    }\n\n    return NextResponse.json(\n      { success: true, message: 'Anfrage erfolgreich gesendet' },\n      { status: 200 }\n    )\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Ung√ºltige Daten', details: error.errors },\n        { status: 400 }\n      )\n    }\n\n    console.error('API error:', error)\n    return NextResponse.json(\n      { error: 'Ein unerwarteter Fehler ist aufgetreten' },\n      { status: 500 }\n    )\n  }\n}\n```\n\n**User Impact**:\n- Validation Errors: Toast mit spezifischer Fehlermeldung\n- Server Errors: Generic Toast \"Fehler beim Senden\"\n- Email Errors: Lead wird trotzdem gespeichert, kein User-Impact\n\n---\n\n#### 3. Calculation Errors\n\n**Scenario**: Calculator Engine wirft Fehler bei Berechnung\n\n**Handling**:\n```typescript\n// lib/calculator/calculator-engine.ts\nexport function calculateComparison(state: CalculatorState): ComparisonResult {\n  try {\n    const headonPrice = calculateHeadonPrice(state)\n    const headonDuration = calculateDuration(state)\n\n    const freelancerPrice = calculateFreelancerPrice(headonPrice, state)\n    const agencyPrice = calculateAgencyPrice(headonPrice, state)\n\n    // ... rest of calculation\n\n    return comparisonResult\n  } catch (error) {\n    console.error('Calculation error:', error)\n\n    // Return safe default fallback\n    return {\n      freelancer: getDefaultProviderEstimate('freelancer'),\n      agency: getDefaultProviderEstimate('agency'),\n      headon: getDefaultProviderEstimate('headon'),\n      savings: { vsFreelancer: { price: 0, time: 0 }, vsAgency: { price: 0, time: 0 } },\n    }\n  }\n}\n```\n\n**User Impact**: Fallback-Werte werden angezeigt, Console Error geloggt\n\n---\n\n#### 4. File Upload Errors (Lead Capture)\n\n**Scenario**: User versucht zu gro√üe Dateien hochzuladen\n\n**Handling**:\n```typescript\n// components/calculator/results/LeadCaptureDialog.tsx\nconst MAX_FILE_SIZE = 5 * 1024 * 1024 // 5MB\nconst ALLOWED_TYPES = ['application/pdf', 'image/jpeg', 'image/png', 'image/webp']\n\nconst validateFile = (file: File): string | null => {\n  if (file.size > MAX_FILE_SIZE) {\n    return `Datei zu gro√ü (max. 5MB): ${file.name}`\n  }\n  if (!ALLOWED_TYPES.includes(file.type)) {\n    return `Ung√ºltiger Dateityp: ${file.name}`\n  }\n  return null\n}\n\nconst handleFileChange = (files: FileList) => {\n  const errors = Array.from(files)\n    .map(validateFile)\n    .filter(Boolean)\n\n  if (errors.length > 0) {\n    toast.error(errors.join('\\n'))\n    return\n  }\n\n  // Process files...\n}\n```\n\n**User Impact**: Toast mit konkreter Fehlermeldung, File wird nicht akzeptiert\n\n---\n\n#### 5. Network Errors\n\n**Scenario**: User hat keine Internet-Verbindung\n\n**Handling**:\n```typescript\n// components/calculator/results/LeadCaptureDialog.tsx\nconst handleSubmit = async (formData: LeadData) => {\n  try {\n    const response = await fetch('/api/calculator', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    })\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`)\n    }\n\n    const data = await response.json()\n    toast.success('Anfrage erfolgreich gesendet!')\n  } catch (error) {\n    console.error('Submit error:', error)\n\n    if (error instanceof TypeError && error.message === 'Failed to fetch') {\n      toast.error('Keine Internet-Verbindung. Bitte versuchen Sie es sp√§ter erneut.')\n    } else {\n      toast.error('Fehler beim Senden. Bitte versuchen Sie es erneut.')\n    }\n  }\n}\n```\n\n**User Impact**: Spezifische Toast-Nachricht je nach Error-Typ\n\n---\n\n## Testing Strategy\n\n### Unit Testing\n\n**Approach**: Jest + Testing Library f√ºr Komponenten und Utilities\n\n**Key Components to Test**:\n\n1. **Calculator Engine** (`lib/calculator/calculator-engine.ts`)\n```typescript\ndescribe('calculateComparison', () => {\n  it('should calculate HEADON price correctly', () => {\n    const state = mockCalculatorState({ projectType: 'website-simple' })\n    const result = calculateComparison(state)\n    expect(result.headon.price.avg).toBeGreaterThan(0)\n  })\n\n  it('should apply design multipliers correctly', () => {\n    const stateTemplate = mockCalculatorState({ design: { level: 'template' } })\n    const statePremium = mockCalculatorState({ design: { level: 'premium' } })\n\n    const resultTemplate = calculateComparison(stateTemplate)\n    const resultPremium = calculateComparison(statePremium)\n\n    expect(resultPremium.headon.price.avg).toBeGreaterThan(resultTemplate.headon.price.avg)\n  })\n})\n```\n\n2. **Pricing Config** (`lib/calculator/pricing-config.ts`)\n```typescript\ndescribe('getBasePrice', () => {\n  it('should return correct base price for each project type', () => {\n    expect(getBasePrice('website-simple')).toEqual({ min: 2500, max: 8000 })\n    expect(getBasePrice('mobile-app')).toEqual({ min: 15000, max: 80000 })\n  })\n})\n```\n\n3. **Utility Functions** (`lib/calculator/utils.ts`)\n```typescript\ndescribe('formatCurrency', () => {\n  it('should format currency with Euro symbol', () => {\n    expect(formatCurrency(12500)).toBe('12.500‚Ç¨')\n    expect(formatCurrency(1000)).toBe('1.000‚Ç¨')\n  })\n})\n\ndescribe('formatDuration', () => {\n  it('should format duration range in weeks', () => {\n    expect(formatDuration({ min: 6, max: 8 })).toBe('6-8 Wochen')\n  })\n})\n```\n\n4. **Validation Schemas** (`lib/calculator/validation-schemas.ts`)\n```typescript\ndescribe('calculatorStateSchema', () => {\n  it('should validate correct state', () => {\n    const state = mockCalculatorState()\n    expect(() => calculatorStateSchema.parse(state)).not.toThrow()\n  })\n\n  it('should reject invalid project type', () => {\n    const state = { ...mockCalculatorState(), projectType: 'invalid' }\n    expect(() => calculatorStateSchema.parse(state)).toThrow()\n  })\n})\n```\n\n---\n\n### Integration Testing\n\n**Approach**: Playwright f√ºr API Routes und End-to-End Flows\n\n**Key Flows to Test**:\n\n1. **API Route Integration**\n```typescript\n// tests/api/calculator.test.ts\ndescribe('/api/calculator', () => {\n  it('should save lead and send email', async () => {\n    const payload = {\n      leadData: mockLeadData(),\n      calculatorData: mockCalculatorState(),\n      comparisonResult: mockComparisonResult(),\n    }\n\n    const response = await fetch('/api/calculator', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    })\n\n    expect(response.status).toBe(200)\n    const data = await response.json()\n    expect(data.success).toBe(true)\n\n    // Verify Supabase entry\n    const { data: leads } = await supabase\n      .from('calculator_leads')\n      .select('*')\n      .eq('email', payload.leadData.email)\n\n    expect(leads).toHaveLength(1)\n  })\n\n  it('should return 400 for invalid data', async () => {\n    const payload = { leadData: { email: 'invalid' } }\n\n    const response = await fetch('/api/calculator', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    })\n\n    expect(response.status).toBe(400)\n  })\n})\n```\n\n2. **Supabase Integration**\n```typescript\ndescribe('Supabase calculator_leads', () => {\n  it('should enforce email validation', async () => {\n    const { error } = await supabase\n      .from('calculator_leads')\n      .insert([{ ...mockLeadData(), email: 'invalid-email' }])\n\n    expect(error).toBeTruthy()\n  })\n\n  it('should calculate lead_score correctly', async () => {\n    const leadData = { ...mockLeadData(), estimated_value: 50000 }\n\n    const { data } = await supabase\n      .from('calculator_leads')\n      .insert([leadData])\n      .select()\n\n    expect(data[0].lead_score).toBeGreaterThan(0)\n  })\n})\n```\n\n---\n\n### End-to-End Testing\n\n**Approach**: Playwright f√ºr komplette User-Flows\n\n**User Scenarios to Test**:\n\n1. **Complete Calculator Flow**\n```typescript\ntest('should complete calculator and submit lead', async ({ page }) => {\n  await page.goto('/kostenrechner')\n\n  // Step 1: Select Project Type\n  await page.click('[data-testid=\"project-type-website-simple\"]')\n  await page.click('button:has-text(\"Weiter\")')\n\n  // Step 2: Configure Design\n  await page.click('[data-testid=\"design-level-custom\"]')\n  await page.fill('[data-testid=\"page-range-slider\"]', '10')\n  await page.click('button:has-text(\"Weiter\")')\n\n  // Step 3: Select Features\n  await page.click('[data-testid=\"feature-cms\"]')\n  await page.click('[data-testid=\"feature-auth\"]')\n  await page.click('button:has-text(\"Weiter\")')\n\n  // Step 4: Quality Options\n  await page.click('[data-testid=\"seo-advanced\"]')\n  await page.click('button:has-text(\"Weiter\")')\n\n  // Step 5: Timeline\n  await page.click('[data-testid=\"timeline-normal\"]')\n  await page.click('button:has-text(\"Weiter\")')\n\n  // Step 6: Results\n  await expect(page.locator('[data-testid=\"comparison-grid\"]')).toBeVisible()\n  await expect(page.locator('[data-testid=\"savings-highlight\"]')).toBeVisible()\n\n  // Submit Lead\n  await page.click('button:has-text(\"Detailliertes Angebot\")')\n  await page.fill('input[name=\"name\"]', 'Test User')\n  await page.fill('input[name=\"email\"]', 'test@example.com')\n  await page.click('button[type=\"submit\"]')\n\n  // Verify Success\n  await expect(page.locator('text=Vielen Dank')).toBeVisible()\n})\n```\n\n2. **Live Preview Update**\n```typescript\ntest('should update live preview on selection change', async ({ page }) => {\n  await page.goto('/kostenrechner')\n\n  // Initial Price\n  const initialPrice = await page.textContent('[data-testid=\"preview-price\"]')\n\n  // Change selection\n  await page.click('[data-testid=\"project-type-mobile-app\"]')\n\n  // Verify Price Updated\n  const updatedPrice = await page.textContent('[data-testid=\"preview-price\"]')\n  expect(updatedPrice).not.toBe(initialPrice)\n})\n```\n\n3. **Mobile Responsiveness**\n```typescript\ntest('should display mobile layout correctly', async ({ page }) => {\n  await page.setViewportSize({ width: 375, height: 667 })\n  await page.goto('/kostenrechner')\n\n  // Verify stacked layout\n  await expect(page.locator('[data-testid=\"calculator-form\"]')).toBeVisible()\n  await expect(page.locator('[data-testid=\"price-preview\"]')).toBeVisible()\n\n  // Navigate to results\n  // ... complete flow ...\n\n  // Verify Tabs instead of Grid\n  await expect(page.locator('[data-testid=\"comparison-tabs\"]')).toBeVisible()\n  await expect(page.locator('[data-testid=\"comparison-grid\"]')).not.toBeVisible()\n})\n```\n\n4. **URL State Persistence**\n```typescript\ntest('should persist state in URL and restore on reload', async ({ page }) => {\n  await page.goto('/kostenrechner')\n\n  // Complete some steps\n  await page.click('[data-testid=\"project-type-ecommerce\"]')\n  await page.click('button:has-text(\"Weiter\")')\n  await page.click('[data-testid=\"design-level-premium\"]')\n\n  // Get current URL\n  const url = page.url()\n  expect(url).toContain('projectType=ecommerce')\n\n  // Reload page\n  await page.goto(url)\n\n  // Verify state restored\n  await expect(page.locator('[data-testid=\"project-type-ecommerce\"]')).toHaveClass(/selected/)\n  await expect(page.locator('[data-testid=\"design-level-premium\"]')).toHaveClass(/selected/)\n})\n```\n\n5. **Accessibility Testing**\n```typescript\ntest('should be keyboard navigable', async ({ page }) => {\n  await page.goto('/kostenrechner')\n\n  // Tab through project types\n  await page.keyboard.press('Tab')\n  await page.keyboard.press('Tab')\n  await page.keyboard.press('Enter')\n\n  // Verify selection\n  await expect(page.locator('[data-testid=\"project-type-website-simple\"]')).toHaveClass(/selected/)\n\n  // Navigate to next step\n  await page.keyboard.press('Tab') // until \"Weiter\" button\n  await page.keyboard.press('Enter')\n\n  // Verify Step 2 loaded\n  await expect(page.locator('text=Design & Umfang')).toBeVisible()\n})\n```\n\n---\n\n### Testing Tools & Configuration\n\n**Test Environment Setup**:\n```json\n// package.json\n{\n  \"scripts\": {\n    \"test\": \"jest\",\n    \"test:watch\": \"jest --watch\",\n    \"test:coverage\": \"jest --coverage\",\n    \"test:e2e\": \"playwright test\",\n    \"test:e2e:headed\": \"playwright test --headed\"\n  },\n  \"devDependencies\": {\n    \"@testing-library/react\": \"^14.0.0\",\n    \"@testing-library/jest-dom\": \"^6.1.0\",\n    \"@playwright/test\": \"^1.55.0\",\n    \"jest\": \"^29.7.0\",\n    \"jest-environment-jsdom\": \"^29.7.0\"\n  }\n}\n```\n\n**Jest Configuration**:\n```javascript\n// jest.config.js\nmodule.exports = {\n  testEnvironment: 'jsdom',\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\n  moduleNameMapper: {\n    '^@/(.*)$': '<rootDir>/$1',\n  },\n  collectCoverageFrom: [\n    'lib/calculator/**/*.{ts,tsx}',\n    'components/calculator/**/*.{ts,tsx}',\n    '!**/*.d.ts',\n  ],\n}\n```\n\n**Playwright Configuration**:\n```typescript\n// playwright.config.ts\nimport { defineConfig } from '@playwright/test'\n\nexport default defineConfig({\n  testDir: './tests/e2e',\n  fullyParallel: true,\n  use: {\n    baseURL: 'http://localhost:3000',\n    trace: 'on-first-retry',\n  },\n  projects: [\n    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },\n    { name: 'mobile', use: { ...devices['iPhone 12'] } },\n  ],\n})\n```\n\n---\n\n## Summary\n\nDieses Design-Dokument definiert:\n\n‚úÖ **Modular Architecture**: 20+ Components in logischen Gruppen (steps, results, shared)\n‚úÖ **Code Reuse**: Maximale Nutzung bestehender Patterns (MultiStepForm, Email Templates, API Routes)\n‚úÖ **Type Safety**: Comprehensive TypeScript Interfaces + Zod Validation\n‚úÖ **Database Design**: Supabase Schema mit RLS, Indexes, Auto-Cleanup\n‚úÖ **Error Handling**: Robuste Fehlerbehandlung auf allen Ebenen\n‚úÖ **Testing Strategy**: Unit + Integration + E2E Tests mit konkreten Beispielen\n\n**N√§chster Schritt**: Tasks Document mit atomaren Implementation Tasks\n",
  "fileStats": {
    "size": 68632,
    "lines": 2495,
    "lastModified": "2025-11-20T12:28:10.590Z"
  },
  "comments": []
}